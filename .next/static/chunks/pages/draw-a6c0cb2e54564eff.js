(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[900],{8291:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/draw",function(){return t(3117)}])},3117:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return u}});var a=t(5893),l=t(7294),s=t(9119);function r(e){let{imageUrl:n,tool:t}=e,s=(0,l.useRef)(null),[r,o]=(0,l.useState)(!1),[i,c]=(0,l.useState)(null),[u,d]=(0,l.useState)(null);(0,l.useEffect)(()=>{try{let e=s.current;if(!e)return;let t=e.getContext("2d");if(!t)throw Error("无法获取画布上下文");c(t);let a=new Image;a.crossOrigin="anonymous",a.src=n,a.onload=()=>{try{e.width=a.width,e.height=a.height,t.drawImage(a,0,0)}catch(e){d("加载图片时出错："+e.message)}},a.onerror=()=>{d("无法加载图片")}}catch(e){d("初始化画布时出错："+e.message)}},[n]);let h=()=>{i&&!u&&(i.closePath(),o(!1))};return u?(0,a.jsx)("div",{className:"canvas-error",children:(0,a.jsx)("p",{children:u})}):(0,a.jsx)("div",{className:"canvas-wrapper",children:(0,a.jsx)("canvas",{ref:s,onMouseDown:e=>{if(!i||u)return;let{offsetX:n,offsetY:t}=e.nativeEvent;i.beginPath(),i.moveTo(n,t),o(!0)},onMouseMove:e=>{if(!r||!i||u)return;let{offsetX:n,offsetY:t}=e.nativeEvent;i.lineTo(n,t),i.stroke()},onMouseUp:h,onMouseOut:h})})}function o(e){let{onTool:n}=e;return(0,a.jsx)("div",{className:"toolbar",children:[{id:"crop",name:"裁剪"},{id:"rotate",name:"旋转"},{id:"remove-bg",name:"抠图"}].map(e=>(0,a.jsx)("button",{onClick:()=>n(e.id),className:"tool-button",children:e.name},e.id))})}function i(e){let{onUpload:n}=e,t=(0,l.useCallback)(e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onload=e=>{n(e.target.result)},e.readAsDataURL(t)}},[n]);return(0,a.jsx)("div",{className:"uploader",children:(0,a.jsxs)("label",{className:"upload-label",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:t,className:"file-input"}),(0,a.jsx)("span",{children:"点击或拖拽图片到此处"})]})})}function c(){return(0,a.jsxs)("div",{className:"loading-overlay",children:[(0,a.jsx)("div",{className:"loading-spinner"}),(0,a.jsx)("p",{children:"处理中..."})]})}function u(){let[e,n]=(0,l.useState)(""),[t,u]=(0,l.useState)(!1),[d,h]=(0,l.useState)(null),m=(0,l.useCallback)(e=>{n(e)},[]),f=(0,l.useCallback)(e=>{h(e)},[]),g=(0,l.useCallback)(async()=>{u(!0);try{let e=document.querySelector("canvas");if(e){let n=e.toDataURL("image/png"),t=document.createElement("a");t.download="edited-image.png",t.href=n,t.click()}}catch(e){console.error("Save failed:",e)}finally{u(!1)}},[]);return(0,a.jsx)(s.Z,{children:(0,a.jsxs)("div",{className:"draw-container",children:[e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r,{imageUrl:e,tool:d}),(0,a.jsx)(o,{onTool:f}),(0,a.jsx)("button",{onClick:g,className:"save-button",children:"保存"})]}):(0,a.jsx)(i,{onUpload:m}),t&&(0,a.jsx)(c,{})]})})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8291)}),_N_E=e.O()}]);