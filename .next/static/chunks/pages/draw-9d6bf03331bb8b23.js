(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[900],{8291:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/draw",function(){return i(5467)}])},5467:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return b}});var n=i(5893),l=i(7294),s=i(7353),o=i(9119),a=i(5364),r=i(6681),c=i(240),h=i(6014);class d extends l.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function u({children:e,isPresent:t}){let i=(0,l.useId)(),s=(0,l.useRef)(null),o=(0,l.useRef)({width:0,height:0,top:0,left:0}),{nonce:a}=(0,l.useContext)(h._);return(0,l.useInsertionEffect)(()=>{let{width:e,height:n,top:l,left:r}=o.current;if(t||!s.current||!e||!n)return;s.current.dataset.motionPopId=i;let c=document.createElement("style");return a&&(c.nonce=a),document.head.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${n}px !important;
            top: ${l}px !important;
            left: ${r}px !important;
          }
        `),()=>{document.head.removeChild(c)}},[t]),(0,n.jsx)(d,{isPresent:t,childRef:s,sizeRef:o,children:l.cloneElement(e,{ref:s})})}let g=({children:e,initial:t,isPresent:i,onExitComplete:s,custom:o,presenceAffectsLayout:a,mode:h})=>{let d=(0,r.h)(w),g=(0,l.useId)(),x=(0,l.useCallback)(e=>{for(let t of(d.set(e,!0),d.values()))if(!t)return;s&&s()},[d,s]),m=(0,l.useMemo)(()=>({id:g,initial:t,isPresent:i,custom:o,onExitComplete:x,register:e=>(d.set(e,!1),()=>d.delete(e))}),a?[Math.random(),x]:[i,x]);return(0,l.useMemo)(()=>{d.forEach((e,t)=>d.set(t,!1))},[i]),l.useEffect(()=>{i||d.size||!s||s()},[i]),"popLayout"===h&&(e=(0,n.jsx)(u,{isPresent:i,children:e})),(0,n.jsx)(c.O.Provider,{value:m,children:e})};function w(){return new Map}var x=i(5947);let m=e=>e.key||"";function p(e){let t=[];return l.Children.forEach(e,e=>{(0,l.isValidElement)(e)&&t.push(e)}),t}var v=i(8868);let f=({children:e,custom:t,initial:i=!0,onExitComplete:s,presenceAffectsLayout:o=!0,mode:c="sync",propagate:h=!1})=>{let[d,u]=(0,x.oO)(h),w=(0,l.useMemo)(()=>p(e),[e]),f=h&&!d?[]:w.map(m),y=(0,l.useRef)(!0),b=(0,l.useRef)(w),j=(0,r.h)(()=>new Map),[k,C]=(0,l.useState)(w),[N,E]=(0,l.useState)(w);(0,v.L)(()=>{y.current=!1,b.current=w;for(let e=0;e<N.length;e++){let t=m(N[e]);f.includes(t)?j.delete(t):!0!==j.get(t)&&j.set(t,!1)}},[N,f.length,f.join("-")]);let M=[];if(w!==k){let e=[...w];for(let t=0;t<N.length;t++){let i=N[t],n=m(i);f.includes(n)||(e.splice(t,0,i),M.push(i))}"wait"===c&&M.length&&(e=M),E(p(e)),C(w);return}let{forceRender:R}=(0,l.useContext)(a.p);return(0,n.jsx)(n.Fragment,{children:N.map(e=>{let l=m(e),a=(!h||!!d)&&(w===N||f.includes(l));return(0,n.jsx)(g,{isPresent:a,initial:(!y.current||!!i)&&void 0,custom:a?void 0:t,presenceAffectsLayout:o,mode:c,onExitComplete:a?void 0:()=>{if(!j.has(l))return;j.set(l,!0);let e=!0;j.forEach(t=>{t||(e=!1)}),e&&(null==R||R(),E(b.current),h&&(null==u||u()),s&&s())},children:e},l)})})};var y=e=>{let{isOpen:t,onClose:i,layers:o,selectedLayer:a,dimensions:r,canvasRef:c,onImageUpdate:h,editMode:d,children:u}=e,g=(0,l.useRef)(null),[w,x]=(0,l.useState)([]),[m,p]=(0,l.useState)(-1),[v,y]=(0,l.useState)({top:0,left:0}),[b,j]=(0,l.useState)(!1),[k,C]=(0,l.useState)(!1),[N,E]=(0,l.useState)(100),[M,R]=(0,l.useState)(0),[S,L]=(0,l.useState)({cursor:"default"}),[P,H]=(0,l.useState)(null),[B,I]=(0,l.useState)(20),[W,T]=(0,l.useState)(!1),[z,D]=(0,l.useState)({x:0,y:0}),[_,O]=(0,l.useState)(!1),[U,F]=(0,l.useState)(null),[X,A]=(0,l.useState)(!1);(0,l.useRef)();let Y=(0,l.useRef)(null);(0,l.useEffect)(()=>{if(!(null==c?void 0:c.current))return;let e=c.current.getBoundingClientRect(),t=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;y({top:e.top+i,left:e.left+t})},[c,t]),(0,l.useEffect)(()=>{if(!t||!(null==o?void 0:o.length)||!g.current)return;let e=g.current,i=e.getContext("2d"),n=window.devicePixelRatio||1;e.width=r.width*n,e.height=r.height*n,e.style.width="".concat(r.width,"px"),e.style.height="".concat(r.height,"px"),i.scale(n,n),i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high";let l=new Image;l.onload=()=>{let t,s,o,a;let c=l.width/l.height;c>r.width/r.height?(s=(t=r.width)/c,o=0,a=(r.height-s)/2):(t=(s=r.height)*c,o=(r.width-t)/2,a=0),i.clearRect(0,0,e.width/n,e.height/n),i.drawImage(l,o,a,t,s);let h=document.createElement("canvas");h.width=e.width,h.height=e.height,h.getContext("2d").drawImage(e,0,0),H(h),x([e.toDataURL()]),p(0)};let s=1===o.length?o[0]:o.find(e=>e.id===a);s&&(l.src=s.src)},[t,o,r,a]);let Q=()=>{if(!g.current){console.error("保存状态时画布引用不存在");return}console.log("开始保存编辑状态");let e=g.current.toDataURL();console.log("获取到新的画布状态"),x(t=>{let i=[...t.slice(0,m+1),e];return console.log("更新历史记录:",{previousLength:t.length,newLength:i.length,currentStep:m}),i}),p(e=>{let t=e+1;return console.log("更新当前步骤:",{previous:e,new:t}),t}),C(!0),console.log("编辑状态已保存")},V=e=>{if(!g.current){console.error("加载状态时画布引用不存在");return}console.log("开始加载状态");let t=g.current,i=t.getContext("2d"),n=new Image;n.onload=()=>{let e,l,s,o;console.log("状态图片加载成功:",{width:n.width,height:n.height}),i.clearRect(0,0,t.width,t.height);let a=n.width/n.height;a>t.width/t.height?(l=(e=t.width)/a,s=0,o=(t.height-l)/2):(e=(l=t.height)*a,s=(t.width-e)/2,o=0);try{i.drawImage(n,s,o,e,l),console.log("状态已恢复到画布，绘制参数:",{x:s,y:o,targetWidth:e,targetHeight:l,canvasWidth:t.width,canvasHeight:t.height})}catch(e){console.error("绘制状态图片时出错:",e)}L(e=>({...e,transform:"scale(".concat(e.transform?1:1.0001,")")}))},n.onerror=e=>{console.error("加载状态图片失败:",e)},n.src=e},$=()=>{if(!g.current)return;let e=g.current;e.getContext("2d");let t=window.devicePixelRatio||1,n=document.createElement("canvas");n.width=r.width*t,n.height=r.height*t;let l=n.getContext("2d"),s=Math.min(r.width*t/e.width,r.height*t/e.height),o=(n.width-e.width*s)/2,a=(n.height-e.height*s)/2;l.drawImage(e,o,a,e.width*s,e.height*s),h(n.toDataURL()),i()},q=e=>{if(!g.current||b)return;j(!0);let t=g.current,i=t.getContext("2d"),n=window.devicePixelRatio||1;t.width=P.width,t.height=P.height,t.style.width="".concat(P.width/n,"px"),t.style.height="".concat(P.height/n,"px"),i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.clearRect(0,0,t.width,t.height),i.save(),i.translate(t.width/2,t.height/2),i.scale(e,e),i.translate(-t.width/2,-t.height/2),i.drawImage(P,0,0,P.width,P.height,0,0,t.width,t.height),i.restore(),j(!1),Q()},J=async()=>{if(!g.current||b)return;j(!0);let e=g.current;try{var t;console.log("开始图片增强处理");let i=e.toDataURL("image/jpeg",.8).split(",")[1];console.log("发送增强请求...");let n=await fetch("/api/image/enhance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_base64:i})});if(console.log("收到响应:",n.status),!n.ok){let e=await n.json();throw Error(e.message||"增强请求失败: ".concat(n.status))}let l=await n.json();if(console.log("响应数据:",l),!l.success)throw Error(l.message||"增强处理失败");if(!(null===(t=l.data)||void 0===t?void 0:t.enhanced_image))throw Error("返回数据中缺少增强结果");let s=new Image;s.onerror=e=>{console.error("图片加载失败:",e),j(!1),alert("图片加载失败，请重试")},s.onload=()=>{let e,t,i,n;if(console.log("增强后的图片加载成功，尺寸:",s.width,"x",s.height),!g.current){console.error("画布引用不存在");return}let l=g.current,o=l.getContext("2d");console.log("当前画布状态:",{width:l.width,height:l.height,style:{width:l.style.width,height:l.style.height}}),o.clearRect(0,0,l.width,l.height);let a=window.devicePixelRatio||1;console.log("设备像素比:",a),l.width=r.width*a,l.height=r.height*a,l.style.width="".concat(r.width,"px"),l.style.height="".concat(r.height,"px"),o.scale(a,a),o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high";let c=s.width/s.height,h=r.width/r.height;c>h?(t=(e=r.width)/c,i=0,n=(r.height-t)/2):(e=(t=r.height)*c,i=(r.width-e)/2,n=0),console.log("绘制增强后的图片，参数:",{imageRatio:c,canvasRatio:h,x:i,y:n,targetWidth:e,targetHeight:t,canvasWidth:l.width,canvasHeight:l.height});try{o.drawImage(s,i,n,e,t),console.log("增强后的图片绘制完成"),j(!1),Q(),L(e=>({...e,transform:"scale(".concat(e.transform?1:1.0001,")")}))}catch(e){throw console.error("绘制增强后的图片时出错:",e),e}},console.log("开始加载增强后的图片数据"),s.crossOrigin="anonymous",s.src=l.data.enhanced_image}catch(e){console.error("增强处理失败:",e),j(!1),alert(e.message||"增强处理失败，请重试")}},G=(e,t,i,n)=>{if(!g.current||b)return;let l=g.current.getContext("2d");window.devicePixelRatio,l.globalCompositeOperation="destination-out",void 0!==i&&void 0!==n?(l.beginPath(),l.moveTo(i,n),l.quadraticCurveTo((i+e)/2,(n+t)/2,e,t),l.lineWidth=2*B,l.lineCap="round",l.lineJoin="round",l.stroke()):(l.beginPath(),l.arc(e,t,B,0,2*Math.PI),l.fill()),l.globalCompositeOperation="source-over"};(0,l.useEffect)(()=>{let e=g.current;if(!e)return;let t=t=>(Y.current||(Y.current=e.getBoundingClientRect()),{x:t.clientX-Y.current.left,y:t.clientY-Y.current.top}),i=e=>{if("erase"!==d)return;e.preventDefault();let i=t(e.touches[0]);A(!0),F(i),D(i),G(i.x,i.y)},n=e=>{if("erase"!==d)return;e.preventDefault();let i=t(e.touches[0]);D(i),X&&U&&(G(i.x,i.y,U.x,U.y),F(i))},l=e=>{"erase"===d&&(e.preventDefault(),A(!1),F(null),Y.current=null,Q())};return"erase"===d&&(e.addEventListener("touchstart",i,{passive:!1}),e.addEventListener("touchmove",n,{passive:!1}),e.addEventListener("touchend",l,{passive:!1}),e.addEventListener("touchcancel",l,{passive:!1})),()=>{e.removeEventListener("touchstart",i),e.removeEventListener("touchmove",n),e.removeEventListener("touchend",l),e.removeEventListener("touchcancel",l)}},[d,X]);let Z=()=>{"erase"===d&&(A(!1),F(null),Y.current=null,Q())},K=e=>{if(!g.current||!P||b)return;j(!0);let t=g.current,i=t.getContext("2d"),n=window.devicePixelRatio||1;t.width=P.width,t.height=P.height,t.style.width="".concat(P.width/n,"px"),t.style.height="".concat(P.height/n,"px"),i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.clearRect(0,0,t.width,t.height),i.save(),i.translate(t.width/2,t.height/2),i.rotate(e*Math.PI/180),i.drawImage(P,-P.width/2,-P.height/2,P.width,P.height),i.restore(),j(!1),Q()},ee=e=>{let t=parseInt(e.target.value);switch(d){case"rotate":R(t),K(t);break;case"zoom":let i=t/100;E(t),q(i);break;case"erase":I(t)}},et=e=>{switch(console.log("处理编辑操作:",e),e){case"matting":en();break;case"enhance":J();break;case"erase":G();break;case"rotate":K();break;case"zoom":q();break;default:console.warn("未知的编辑操作:",e)}},ei=()=>{k?window.confirm("是否应用当前的编辑更改？")?$():(C(!1),i()):i()};(0,l.useEffect)(()=>{t||(C(!1),x([]),p(-1),E(100),R(0),H(null))},[t]);let en=async()=>{if(!g.current||b)return;j(!0);let e=g.current;try{var t;let i=e.toDataURL("image/jpeg",.8).split(",")[1];console.log("Sending matting request...");let n=await fetch("/api/image/matting",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_base64:i})});if(console.log("Received response:",n.status),!n.ok){let e=await n.json();throw Error(e.message||"抠图请求失败: ".concat(n.status))}let l=await n.json();if(console.log("Response data:",l),!l.success)throw Error(l.message||"抠图处理失败");if(!(null===(t=l.data)||void 0===t?void 0:t.foreground_image))throw Error("返回数据中缺少抠图结果");let s=new Image;s.onerror=e=>{console.error("图片加载失败:",e),j(!1),alert("图片加载失败，请重试")},s.onload=()=>{let e,t,i,n;if(console.log("图片加载成功，尺寸:",s.width,"x",s.height),!g.current){console.error("画布引用不存在");return}let l=g.current,o=l.getContext("2d");console.log("当前画布状态:",{width:l.width,height:l.height,style:{width:l.style.width,height:l.style.height}}),o.clearRect(0,0,l.width,l.height);let a=window.devicePixelRatio||1;console.log("设备像素比:",a),l.width=r.width*a,l.height=r.height*a,l.style.width="".concat(r.width,"px"),l.style.height="".concat(r.height,"px"),o.scale(a,a);let c=s.width/s.height,h=r.width/r.height;c>h?(t=(e=r.width)/c,i=0,n=(r.height-t)/2):(e=(t=r.height)*c,i=(r.width-e)/2,n=0),console.log("绘制参数:",{imageRatio:c,canvasRatio:h,x:i,y:n,targetWidth:e,targetHeight:t,canvasWidth:l.width,canvasHeight:l.height});try{o.drawImage(s,i,n,e,t),console.log("图片绘制完成")}catch(e){console.error("绘制图片时出错:",e)}j(!1),Q(),L(e=>({...e,transform:"scale(".concat(e.transform?1:1.0001,")")}))},console.log("开始加载图片数据"),s.src=l.data.foreground_image}catch(e){console.error("抠图处理错误:",e),alert(e.message||"抠图处理失败，请重试"),j(!1)}};return((0,l.useEffect)(()=>{L(e=>({...e,cursor:"erase"===d?"none":"default"})),O("erase"===d)},[d]),t)?(0,n.jsx)(f,{mode:"wait",children:(0,n.jsx)(s.E.div,{className:"modal-backdrop",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:ei,children:(0,n.jsxs)(s.E.div,{className:"modal-content",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("div",{className:"modal-header",children:(0,n.jsx)("button",{className:"close-button",onClick:ei,children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,n.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})}),(0,n.jsxs)("div",{className:"modal-body",children:[(0,n.jsxs)("div",{className:"edit-canvas-container",style:{height:"84%",position:"relative",background:"rgba(255, 255, 255, 0.12)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"0.6rem",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",boxShadow:"inset 0 2px 4px rgba(0, 0, 0, 0.02)"},onMouseDown:e=>{if("erase"!==d)return;Y.current||(Y.current=g.current.getBoundingClientRect());let t=e.clientX-Y.current.left,i=e.clientY-Y.current.top;A(!0),F({x:t,y:i}),D({x:t,y:i}),G(t,i)},onMouseMove:e=>{if("erase"!==d)return;Y.current||(Y.current=g.current.getBoundingClientRect());let t=e.clientX-Y.current.left,i=e.clientY-Y.current.top;D({x:t,y:i}),X&&U&&(G(t,i,U.x,U.y),F({x:t,y:i}))},onMouseUp:Z,onMouseLeave:Z,children:[(0,n.jsx)("canvas",{ref:g,className:"edit-canvas",style:{position:"relative",width:"100%",height:"100%",...S}}),_&&(0,n.jsx)("div",{className:"eraser-preview",style:{position:"absolute",left:z.x,top:z.y,width:2*B,height:2*B,border:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"50%",pointerEvents:"none",transform:"translate(-50%, -50%)",transition:"width 0.2s, height 0.2s",zIndex:1e3}})]}),("zoom"===d||"rotate"===d||"erase"===d)&&(0,n.jsxs)("div",{className:"slider-controls",children:["rotate"===d&&(0,n.jsxs)("div",{className:"slider-group",children:[(0,n.jsx)("input",{type:"range",min:"-180",max:"180",value:M,onChange:ee,className:"edit-slider"}),(0,n.jsxs)("span",{className:"slider-value",children:[M,"\xb0"]})]}),"zoom"===d&&(0,n.jsxs)("div",{className:"slider-group",children:[(0,n.jsx)("input",{type:"range",min:"50",max:"200",value:N,onChange:ee,className:"edit-slider"}),(0,n.jsxs)("span",{className:"slider-value",children:[N,"%"]})]}),"erase"===d&&(0,n.jsxs)("div",{className:"slider-group",children:[(0,n.jsx)("input",{type:"range",min:"5",max:"50",value:B,onChange:ee,className:"edit-slider",style:{width:"200px",margin:"0 10px"}}),(0,n.jsxs)("span",{className:"slider-value",children:[B,"px"]})]})]}),(0,n.jsxs)("div",{className:"edit-tools",children:[(0,n.jsx)("div",{className:"tool-icons",children:u&&l.Children.map(u,(e,t)=>{if(!e)return null;let i=l.Children.toArray(e.props.children).find(e=>"svg"===e.type||e.props&&"button-icon"===e.props.className),o=l.Children.toArray(e.props.children).find(e=>"span"===e.type&&"button-text"===e.props.className);return(0,n.jsxs)(s.E.button,{onClick:()=>et(d),disabled:b,className:"tool-button",whileHover:{scale:1.05},whileTap:{scale:.95},style:{background:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(0, 0, 0, 0.08)",padding:"0.5rem 0.9rem",borderRadius:"0.6rem",color:"rgba(0, 0, 0, 0.8)",fontSize:"0.9rem",fontWeight:"500",display:"flex",alignItems:"center",gap:"0.5rem",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.04)",transition:"all 0.2s ease"},children:[i,o]})})}),(0,n.jsxs)("div",{className:"action-buttons",children:[(0,n.jsx)(s.E.button,{className:"tool-button",onClick:$,disabled:b||w.length<=1,whileHover:{scale:1.05},whileTap:{scale:.95},style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.2)",padding:"0.5rem",borderRadius:"0.6rem",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.04)",transition:"all 0.2s ease"},children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,n.jsx)("path",{d:"M20 6L9 17l-5-5"})})}),(0,n.jsx)(s.E.button,{className:"tool-button",onClick:()=>{m>0&&(p(e=>e-1),V(w[m-1]))},disabled:b||m<=0,whileHover:{scale:1.05},whileTap:{scale:.95},style:{background:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(0, 0, 0, 0.08)",padding:"0.5rem",borderRadius:"0.6rem",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.04)",transition:"all 0.2s ease"},children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M9 14L4 9l5-5"}),(0,n.jsx)("path",{d:"M4 9h11a4 4 0 0 1 0 8h-1"})]})}),(0,n.jsx)(s.E.button,{className:"tool-button",onClick:()=>{m<w.length-1&&(p(e=>e+1),V(w[m+1]))},disabled:b||m>=w.length-1,whileHover:{scale:1.05},whileTap:{scale:.95},style:{background:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(0, 0, 0, 0.08)",padding:"0.5rem",borderRadius:"0.6rem",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.04)",transition:"all 0.2s ease"},children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M15 14l5-5-5-5"}),(0,n.jsx)("path",{d:"M20 9H9a4 4 0 0 0 0 8h1"})]})})]})]})]})]},"modal-content")},"modal-backdrop")}):null};function b(){let e=(0,l.useRef)(null),t=(0,l.useRef)(null),[i,a]=(0,l.useState)({width:0,height:0}),[r,c]=(0,l.useState)(!1),[h,d]=(0,l.useState)(!1),[u,g]=(0,l.useState)([]),[w,x]=(0,l.useState)(!1),m=(0,l.useRef)(null),[p,v]=(0,l.useState)(null),[f,b]=(0,l.useState)({}),[j,k]=(0,l.useState)(!1),[C,N]=(0,l.useState)({x:0,y:0}),[E,M]=(0,l.useState)({}),R=(0,l.useRef)(null),[S,L]=(0,l.useState)(null),[P,H]=(0,l.useState)(0),[B,I]=(0,l.useState)(!1),W=()=>{let e=Math.min(window.innerWidth-32,800),t=e/(3/4),i=window.innerHeight-32-80-50;t>i?a({width:3/4*i,height:i}):a({width:e,height:t})};(0,l.useEffect)(()=>(W(),window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)),[]),(0,l.useEffect)(()=>{if(e.current&&i.width&&i.height){let t=e.current,n=t.getContext("2d"),l=window.devicePixelRatio||1;t.width=i.width*l,t.height=i.height*l,t.style.width="".concat(i.width,"px"),t.style.height="".concat(i.height,"px"),n.scale(l,l),n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.fillStyle="#ffffff",n.fillRect(0,0,i.width,i.height)}},[i]);let T=t=>{if(!t.type.startsWith("image/")){alert("请选择图片文件");return}let n=new FileReader;n.onload=n=>{var l;let s=new Image;s.onload=()=>{var l;let o,a,r,h;let d=e.current;if(!d)return;let u=d.getContext("2d"),w=window.devicePixelRatio||1,x=i.width*w,m=x/(3/4);d.width=x,d.height=m,d.style.width="".concat(x/w,"px"),d.style.height="".concat(m/w,"px"),u.fillStyle="#ffffff",u.fillRect(0,0,x,m),u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high";let p=s.width/s.height;if(1===p){let e=Math.min(x,m);o=e,a=e,r=(x-e)/2,h=(m-e)/2}else p>1?(o=x,r=0,h=(m-(a=x/p))/2):(a=m,r=(x-(o=m*p))/2,h=0);u.drawImage(s,r,h,o,a),c(!0);let v={id:Date.now(),name:t.name,src:(null===(l=n.target)||void 0===l?void 0:l.result)||"",visible:!0,width:s.width,height:s.height};g([v]),b({[v.id]:{x:0,y:0}})},s.src=(null===(l=n.target)||void 0===l?void 0:l.result)||""},n.readAsDataURL(t)},z=e=>{if(!e.type.startsWith("image/")){alert("请选择图片文件");return}if(u.length>=5){alert("最多只能添加5个图层");return}let t=new FileReader;t.onload=t=>{var i;let n=new Image;n.onload=()=>{var i;let l={id:Date.now(),name:e.name,src:(null===(i=t.target)||void 0===i?void 0:i.result)||"",visible:!0,width:n.width,height:n.height};g(e=>[l,...e]),b(e=>({...e,[l.id]:{x:0,y:0}}))},n.src=(null===(i=t.target)||void 0===i?void 0:i.result)||""},t.readAsDataURL(e)},D=e=>{if(0===e)return;let t=[...u];[t[e],t[e-1]]=[t[e-1],t[e]],g(t)},_=e=>{if(e===u.length-1)return;let t=[...u];[t[e],t[e+1]]=[t[e+1],t[e]],g(t)},O=e=>{g(t=>t.map(t=>t.id===e?{...t,visible:!t.visible}:t))},U=(e,t)=>{null==t||t.stopPropagation(),v(e===p?null:e)},F=(0,l.useCallback)((e,t,i)=>{let{left:n,top:l,width:s,height:o}=i;return e>=n&&e<=n+s&&t>=l&&t<=l+o},[]),X=(0,l.useCallback)((t,i)=>{let n=e.current;if(!n)return null;let l=window.devicePixelRatio||1;for(let e of u){let s,o,a,r;if(!e.visible)continue;let c=new Image;c.src=e.src;let h=c.width/c.height;if(1===h){let e=Math.min(n.width,n.height);s=e/l,o=e/l,a=(n.width/l-s)/2,r=(n.height/l-o)/2}else h>1?(s=n.width/l,o=n.width/l/h,a=0,r=(n.height/l-o)/2):(o=n.height/l,s=n.height/l*h,a=(n.width/l-s)/2,r=0);let d=f[e.id]||{x:0,y:0};if(F(t,i,{left:a+=d.x,top:r+=d.y,width:s,height:o}))return e.id}return null},[u,f,F]);(0,l.useCallback)(e=>new Promise(t=>{if(E[e.id]){t(E[e.id]);return}let i=new Image;i.onload=()=>{M(t=>({...t,[e.id]:i})),t(i)},i.src=e.src}),[E]),(0,l.useEffect)(()=>{if(i.width&&i.height){let e=document.createElement("canvas"),t=window.devicePixelRatio||1;e.width=i.width*t,e.height=i.height*t,R.current=e}},[i]);let A=(0,l.useCallback)(()=>{if(!e.current)return;let t=e.current,i=t.getContext("2d"),n=window.devicePixelRatio||1;i.fillStyle="#ffffff",i.fillRect(0,0,t.width,t.height),Promise.all([...u].reverse().map(e=>e.visible?new Promise((l,s)=>{let o=new Image;o.onload=()=>{try{let s,a,r,c;let h=o.width/o.height;if(1===h){let e=Math.min(t.width,t.height);s=e,a=e,r=(t.width-e)/2,c=(t.height-e)/2}else h>1?(s=t.width,a=t.width/h,r=0,c=(t.height-a)/2):(a=t.height,s=t.height*h,r=(t.width-s)/2,c=0);let d=f[e.id]||{x:0,y:0};i.save(),i.translate(d.x*n,d.y*n),e.id===p&&(i.shadowColor="rgba(59, 130, 246, 0.5)",i.shadowBlur=8,i.shadowOffsetX=0,i.shadowOffsetY=0),i.drawImage(o,r,c,s,a),i.restore(),l()}catch(e){console.error("Error drawing layer:",e),s(e)}},o.onerror=()=>{console.error("Error loading image for layer:",e.id),s(Error("Image load failed"))},o.src=e.src}):Promise.resolve())).catch(e=>{console.error("Error rendering layers:",e)})},[u,f,p]),Y=(0,l.useCallback)((e,t,i)=>{let n=requestAnimationFrame(()=>{b(n=>{var l,s;return{...n,[e]:{x:((null===(l=n[e])||void 0===l?void 0:l.x)||0)+t,y:((null===(s=n[e])||void 0===s?void 0:s.y)||0)+i}}})});return()=>cancelAnimationFrame(n)},[]),Q=(0,l.useCallback)(t=>{var i;if(!j||!p&&!r)return;let n=e.current.getBoundingClientRect(),l=t.clientX-n.left,s=t.clientY-n.top,o=(l-C.x)/(window.devicePixelRatio||1),a=(s-C.y)/(window.devicePixelRatio||1),c=p||(null===(i=u[0])||void 0===i?void 0:i.id);c&&Y(c,o,a),N({x:l,y:s})},[j,p,r,u,C,Y]),V=()=>{k(!1)};(0,l.useEffect)(()=>{A()},[u,A]);let $=()=>{k(!1)};(0,l.useCallback)(e=>{let t=document.createElement("canvas"),i=t.getContext("2d");t.width=40,t.height=40;let n=new Image;return n.onload=()=>{let e,t,l,s;let o=n.width/n.height;1===o?(e=t=40,l=s=0):o>1?(e=40,l=0,s=(40-(t=40/o))/2):(t=40,l=(40-(e=40*o))/2,s=0),i.drawImage(n,l,s,e,t)},n.src=e.src,t},[]);let q=(0,l.useCallback)(e=>{!w||e.target.closest(".layers-panel")||e.target.closest(".canvas-layers")||x(!1)},[w]);(0,l.useEffect)(()=>(document.addEventListener("mousedown",q),()=>{document.removeEventListener("mousedown",q)}),[q]);let J=e=>{g(t=>t.filter(t=>t.id!==e)),p===e&&v(null)},G=e=>{e.target.closest(".draw-canvas")||e.target.closest(".layers-panel")||e.target.closest(".layers-mini")||v(null)};return(0,l.useEffect)(()=>(document.addEventListener("click",G),()=>{document.removeEventListener("click",G)}),[]),(0,n.jsxs)(o.Z,{children:[(0,n.jsxs)("div",{className:"draw-container",children:[(0,n.jsxs)(s.E.div,{className:"canvas-wrapper ".concat(h?"dragging":""),initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),d(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),d(!1)},onDrop:e=>{var t;e.preventDefault(),e.stopPropagation(),d(!1);let i=null===(t=e.dataTransfer.files)||void 0===t?void 0:t[0];i&&T(i)},children:[(0,n.jsx)("canvas",{ref:e,className:"draw-canvas ".concat(h?"dragging":""),width:i.width,height:i.height,onMouseDown:t=>{let i=e.current;if(!i)return;let n=i.getBoundingClientRect(),l=t.clientX-n.left,s=t.clientY-n.top,o=X(l,s);o?(k(!0),N({x:l,y:s}),v(o)):v(null)},onMouseMove:Q,onMouseUp:V,onMouseLeave:V,onTouchStart:t=>{if(!r)return;let i=e.current.getBoundingClientRect(),n=t.touches[0],l=n.clientX-i.left,s=n.clientY-i.top,o=X(l,s);o?(v(o),k(!0),N({x:l,y:s})):v(null)},onTouchMove:t=>{var i;if(!j||!p&&!r)return;t.preventDefault();let n=e.current.getBoundingClientRect(),l=t.touches[0],s=l.clientX-n.left,o=l.clientY-n.top,a=s-C.x,c=o-C.y,h=p||(null===(i=u[0])||void 0===i?void 0:i.id);h&&Y(h,a,c),N({x:s,y:o})},onTouchEnd:$,onTouchCancel:$,style:{cursor:r?"move":"default",position:"relative"},children:u.map((e,t)=>{var i,l;return(0,n.jsx)("div",{className:"canvas-layer ".concat(p===e.id?"selected":""),style:{position:"absolute",left:(null===(i=f[e.id])||void 0===i?void 0:i.x)||0,top:(null===(l=f[e.id])||void 0===l?void 0:l.y)||0,display:e.visible?"block":"none",zIndex:u.length-t,pointerEvents:"none"},children:(0,n.jsx)("img",{src:e.src,alt:"图层 ".concat(t+1),style:{width:e.width,height:e.height,pointerEvents:"none"},draggable:!1})},e.id)})}),(0,n.jsx)("input",{type:"file",ref:m,onChange:e=>{var t;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];i&&z(i)},accept:"image/*",style:{display:"none"}}),(0,n.jsxs)("div",{className:"layers-container",children:[(0,n.jsxs)(s.E.button,{className:"canvas-layers",onClick:()=>x(!w),initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},title:"图层管理",children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),(0,n.jsx)("path",{d:"M2 17l10 5 10-5"}),(0,n.jsx)("path",{d:"M2 12l10 5 10-5"})]}),(0,n.jsx)("span",{className:"layer-count",children:u.length})]}),!w&&u.length>0&&(0,n.jsx)(s.E.div,{className:"layers-mini",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3},children:u.map((e,t)=>(0,n.jsxs)(s.E.div,{className:"layer-mini-item ".concat(e.visible?"visible":""," ").concat(p===e.id?"selected":""),initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2,delay:.05*t},onClick:t=>U(e.id,t),children:[(0,n.jsx)("img",{src:e.src,alt:e.name,className:"layer-mini-preview",draggable:!1}),(0,n.jsx)("span",{className:"layer-mini-index",children:t+1})]},e.id))}),w&&(0,n.jsxs)(s.E.div,{className:"layers-panel",initial:{opacity:0,scale:.95,x:-20},animate:{opacity:1,scale:1,x:0},transition:{duration:.3},children:[(0,n.jsx)("div",{className:"layers-list",children:u.map((e,t)=>(0,n.jsxs)(s.E.div,{className:"layer-item ".concat(e.visible?"visible":""," ").concat(p===e.id?"selected":""),initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2,delay:.05*t},children:[(0,n.jsxs)("div",{className:"layer-preview-container ".concat(p===e.id?"selected":""),onClick:t=>U(e.id,t),children:[(0,n.jsx)("img",{src:e.src,alt:"图层 ".concat(t+1),className:"layer-preview",draggable:!1}),(0,n.jsx)("span",{className:"layer-index",children:t+1})]}),(0,n.jsxs)("div",{className:"layer-controls",children:[(0,n.jsx)("button",{className:"layer-visibility ".concat(e.visible?"visible":""),onClick:t=>{t.stopPropagation(),O(e.id)},title:e.visible?"隐藏图层":"显示图层",children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,n.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,n.jsx)("button",{className:"layer-move-btn",onClick:e=>{e.stopPropagation(),D(t)},disabled:0===t,title:"上移图层",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,n.jsx)("path",{d:"M12 19V5M5 12l7-7 7 7"})})}),(0,n.jsx)("button",{className:"layer-move-btn",onClick:e=>{e.stopPropagation(),_(t)},disabled:t===u.length-1,title:"下移图层",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,n.jsx)("path",{d:"M12 5v14M5 12l7 7 7-7"})})}),(0,n.jsx)("button",{className:"layer-delete-btn",onClick:t=>{t.stopPropagation(),J(e.id)},title:"删除图层",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,n.jsx)("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]})]},e.id))}),u.length<5&&(0,n.jsx)("div",{className:"layers-footer",children:(0,n.jsx)(s.E.button,{className:"layer-add-btn",onClick:()=>{var e;null===(e=m.current)||void 0===e||e.click()},whileHover:{scale:1.02},whileTap:{scale:.98},title:"添加图层",children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,n.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})})]})]}),r&&(0,n.jsx)(s.E.button,{className:"canvas-download",onClick:()=>{v(null),requestAnimationFrame(()=>{let t=e.current;if(!t)return;let i=document.createElement("a");i.download="canvas-image.png",i.href=t.toDataURL("image/png"),i.click()})},initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},title:"下载图片",children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,n.jsx)("polyline",{points:"7 10 12 15 17 10"}),(0,n.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),!r&&(0,n.jsxs)("div",{className:"upload-hint",children:[(0,n.jsx)("div",{className:"hint-icon",children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,n.jsx)("polyline",{points:"17 8 12 3 7 8"}),(0,n.jsx)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})}),(0,n.jsx)("h3",{children:"点击或拖拽上传图片"}),(0,n.jsx)("p",{children:"支持 JPG、PNG、GIF 格式"})]})]}),r&&(0,n.jsx)(s.E.div,{className:"canvas-tools",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:(0,n.jsx)("div",{className:"tools-buttons ".concat(S?"editing":""),children:S?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(s.E.div,{className:"edit-controls",initial:{x:20,opacity:0},animate:{x:0,opacity:1},transition:{duration:.3,delay:.1}})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(s.E.button,{className:"tool-button matting",onClick:()=>{if(u.length>1&&!p){alert("请先选择要编辑的图层");return}L("matting"),I(!0)},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("circle",{cx:"6",cy:"6",r:"3"}),(0,n.jsx)("circle",{cx:"6",cy:"18",r:"3"}),(0,n.jsx)("line",{x1:"20",y1:"4",x2:"8.12",y2:"15.88"}),(0,n.jsx)("line",{x1:"14.47",y1:"14.48",x2:"20",y2:"20"}),(0,n.jsx)("line",{x1:"8.12",y1:"8.12",x2:"12",y2:"12"})]}),(0,n.jsx)("span",{className:"button-text",children:"抠图"})]}),(0,n.jsxs)(s.E.button,{className:"tool-button enhance",onClick:()=>{if(u.length>1&&!p){alert("请先选择要编辑的图层");return}L("enhance"),I(!0)},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,n.jsx)("path",{d:"M12 4v2M12 18v2M4 12H2M22 12h-2M19.07 4.93l-1.41 1.41M6.34 17.66l-1.41 1.41M19.07 19.07l-1.41-1.41M6.34 6.34L4.93 4.93"})]}),(0,n.jsx)("span",{className:"button-text",children:"增强"})]}),(0,n.jsxs)(s.E.button,{className:"tool-button erase",onClick:()=>{if(u.length>1&&!p){alert("请先选择要编辑的图层");return}L("erase"),I(!0)},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,n.jsx)("path",{d:"M20 20H7L3 16c-.7-.7-.7-1.3 0-2l7-7c.7-.7 1.3-.7 2 0l5 5c.7.7.7 1.3 0 2l-7 7"})}),(0,n.jsx)("span",{className:"button-text",children:"擦除"})]}),(0,n.jsxs)(s.E.button,{className:"tool-button rotate",onClick:()=>{if(u.length>1&&!p){alert("请先选择要编辑的图层");return}L("rotate"),I(!0)},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),(0,n.jsx)("path",{d:"M3 3v5h5"})]}),(0,n.jsx)("span",{className:"button-text",children:"旋转"})]}),(0,n.jsxs)(s.E.button,{className:"tool-button zoom",onClick:()=>{if(u.length>1&&!p){alert("请先选择要编辑的图层");return}L("zoom"),I(!0)},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,n.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),(0,n.jsx)("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),(0,n.jsx)("line",{x1:"8",y1:"11",x2:"14",y2:"11"})]}),(0,n.jsx)("span",{className:"button-text",children:"缩放"})]})]})})}),(0,n.jsx)(s.E.div,{className:"canvas-buttons",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:r?(0,n.jsxs)("div",{className:"function-buttons",children:[(0,n.jsxs)(s.E.button,{className:"canvas-button smart-portrait",onClick:()=>{console.log("智能画像")},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8z"}),(0,n.jsx)("path",{d:"M12 6a4 4 0 1 0 4 4 4 4 0 0 0-4-4z"})]}),"智能画像"]}),(0,n.jsxs)(s.E.button,{className:"canvas-button style",onClick:()=>{console.log("风格叠加")},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M2 2h20v20H2z"}),(0,n.jsx)("path",{d:"M7 7h10v10H7z"})]}),"风格叠加"]}),(0,n.jsxs)(s.E.button,{className:"canvas-button product",onClick:()=>{console.log("商品选择")},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M21 8l-3-6H6L3 8v12h18V8z"}),(0,n.jsx)("path",{d:"M3 8h18"}),(0,n.jsx)("path",{d:"M15 8a3 3 0 0 1-6 0"})]}),"商品选择"]}),(0,n.jsxs)(s.E.button,{className:"canvas-button order",onClick:()=>{console.log("订单发货")},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M5 12h14"}),(0,n.jsx)("path",{d:"M12 5l7 7-7 7"})]}),"订单发货"]})]}):(0,n.jsxs)("div",{className:"initial-buttons",children:[(0,n.jsx)("input",{type:"file",ref:t,onChange:e=>{var t;let i=null===(t=e.target.files)||void 0===t?void 0:t[0];i&&T(i)},accept:"image/*",style:{display:"none"}}),(0,n.jsxs)(s.E.button,{className:"canvas-button upload",onClick:()=>{var e;null===(e=t.current)||void 0===e||e.click()},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,n.jsx)("polyline",{points:"17 8 12 3 7 8"}),(0,n.jsx)("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),"上传图片"]}),(0,n.jsxs)(s.E.button,{className:"canvas-button archive",onClick:()=>{console.log("存档仓库")},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M21 8v13H3V8"}),(0,n.jsx)("path",{d:"M1 3h22v5H1z"}),(0,n.jsx)("path",{d:"M10 12h4"})]}),"存档仓库"]})]})})]}),(0,n.jsxs)(y,{isOpen:B,onClose:()=>{I(!1),L(null)},layers:u,selectedLayer:p,dimensions:i,canvasRef:e,onImageUpdate:e=>{g(t=>{let i=[...t],n=1===u.length?0:i.findIndex(e=>e.id===p);return -1!==n&&(i[n]={...i[n],src:e}),i})},editMode:S,children:["matting"===S&&(0,n.jsxs)(s.E.button,{className:"tool-button",onClick:()=>{},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),(0,n.jsx)("path",{d:"M12 6v12"}),(0,n.jsx)("path",{d:"M6 12h12"})]}),(0,n.jsx)("span",{className:"button-text",children:"抠图"})]}),"enhance"===S&&(0,n.jsxs)(s.E.button,{className:"tool-button",onClick:()=>{},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,n.jsx)("path",{d:"M12 4v2M12 18v2M4 12H2M22 12h-2M19.07 4.93l-1.41 1.41M6.34 17.66l-1.41 1.41M19.07 19.07l-1.41-1.41M6.34 6.34L4.93 4.93"})]}),(0,n.jsx)("span",{className:"button-text",children:"增强"})]}),"erase"===S&&(0,n.jsxs)(s.E.button,{className:"tool-button",onClick:()=>{},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,n.jsx)("path",{d:"M20 20H7L3 16c-.7-.7-.7-1.3 0-2l7-7c.7-.7 1.3-.7 2 0l5 5c.7.7.7 1.3 0 2l-7 7"})}),(0,n.jsx)("span",{className:"button-text",children:"擦除"})]}),"rotate"===S&&(0,n.jsxs)(s.E.button,{className:"tool-button",onClick:()=>{},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),(0,n.jsx)("path",{d:"M3 3v5h5"})]}),(0,n.jsx)("span",{className:"button-text",children:"旋转"})]}),"zoom"===S&&(0,n.jsxs)(s.E.button,{className:"tool-button",onClick:()=>{},whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"button-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,n.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),(0,n.jsx)("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),(0,n.jsx)("line",{x1:"8",y1:"11",x2:"14",y2:"11"})]}),(0,n.jsx)("span",{className:"button-text",children:"缩放"})]})]})]})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8291)}),_N_E=e.O()}]);