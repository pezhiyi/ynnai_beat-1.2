"use strict";(()=>{var e={};e.id=791,e.ids=[791],e.modules={6413:e=>{e.exports=require("cos-nodejs-sdk-v5")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,n)=>{Object.defineProperty(n,"l",{enumerable:!0,get:function(){return function e(n,t){return t in n?n[t]:"then"in n&&"function"==typeof n.then?n.then(n=>e(n,t)):"function"==typeof n&&"default"===t?n:void 0}}})},2220:(e,n,t)=>{t.r(n),t.d(n,{config:()=>d,default:()=>g,routeModule:()=>p});var o={};t.r(o),t.d(o,{config:()=>c,default:()=>l});var s=t(1802),r=t(7153),a=t(6249),i=t(6413);let u=new(t.n(i)())({SecretId:process.env.TENCENT_CLOUD_SECRET_ID,SecretKey:process.env.TENCENT_CLOUD_SECRET_KEY}),c={api:{bodyParser:{sizeLimit:"10mb"}}};async function l(e,n){if("POST"!==e.method)return n.status(405).json({success:!1,message:"只支持 POST 请求"});try{let{image_base64:t}=e.body;if(!t)return n.status(400).json({success:!1,message:"缺少图片数据"});let o=Buffer.from(t,"base64"),s=Date.now(),r=`enhance_${s}.jpg`,a=`enhanced_${s}.jpg`;console.log("上传图片并进行增强处理..."),await new Promise((e,n)=>{u.putObject({Bucket:"ynnai-1256269009",Region:"ap-guangzhou",Key:r,Body:o,ContentType:"image/jpeg",Headers:{"Pic-Operations":JSON.stringify({is_pic_info:1,rules:[{fileid:a,rule:"ci-process=AIEnhanceImage"}]})}},(t,o)=>{t?(console.error("增强处理失败:",t),n(t)):(console.log("增强处理成功:",o),e(o))})}),await new Promise(e=>setTimeout(e,1e3)),console.log("获取增强后的图片...");let i=await new Promise((e,n)=>{u.getObject({Bucket:"ynnai-1256269009",Region:"ap-guangzhou",Key:a},(t,o)=>{if(t)console.error("获取增强后的图片失败:",t),n(t);else{console.log("获取增强后的图片成功");let n=Buffer.from(o.Body).toString("base64");e(n)}})});if(console.log("清理临时文件..."),await Promise.all([new Promise(e=>{u.deleteObject({Bucket:"ynnai-1256269009",Region:"ap-guangzhou",Key:r},()=>e())}),new Promise(e=>{u.deleteObject({Bucket:"ynnai-1256269009",Region:"ap-guangzhou",Key:a},()=>e())})]),!i)throw Error("增强后的图片数据为空");return n.status(200).json({success:!0,data:{enhanced_image:`data:image/jpeg;base64,${i}`}})}catch(e){return console.error("增强处理出错:",e),n.status(500).json({success:!1,message:e.message||"增强处理失败"})}}let g=(0,a.l)(o,"default"),d=(0,a.l)(o,"config"),p=new s.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/image/enhance",pathname:"/api/image/enhance",bundlePath:"",filename:""},userland:o})},7153:(e,n)=>{var t;Object.defineProperty(n,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,n,t)=>{e.exports=t(145)}};var n=require("../../../webpack-api-runtime.js");n.C(e);var t=n(n.s=2220);module.exports=t})();